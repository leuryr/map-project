var Model=[{name:"Yankee Stadium",location:{lat:40.829622,lng:-73.926173},visible:ko.observable(!0),active:ko.observable(!1),address:"1 E 161st St, Bronx NY"},{name:"The Bronx Museum of the Arts",location:{lat:40.831011,lng:-73.919719},visible:ko.observable(!0),active:ko.observable(!1),address:"1040 Grand Concourse, Bronx NY"},{name:"Concourse Plaza",location:{lat:40.825227,lng:-73.920491},visible:ko.observable(!0),active:ko.observable(!1),address:"220 E 161st St, Bronx NY"},{name:"Bronx County Family Court",location:{lat:40.826746,lng:-73.920696},visible:ko.observable(!0),active:ko.observable(!1),address:"900 Sheridan Ave, Bronx NY"},{name:"Bronx County Hall of Justice",location:{lat:40.826102,lng:-73.919612},visible:ko.observable(!0),active:ko.observable(!1),address:"265 E 161st St, Bronx NY"},{name:"Bronx Supreme Court",location:{lat:40.826173,lng:-73.923834},visible:ko.observable(!0),active:ko.observable(!1),address:"851 Grand Concourse #111, Bronx NY"},{name:"Heritage Field",location:{lat:40.827023,lng:-73.927761},visible:ko.observable(!0),active:ko.observable(!1),address:", Bronx NY"},{name:"Joseph Yancey Track and Field",location:{lat:40.828025,lng:-73.929016},visible:ko.observable(!0),active:ko.observable(!1),address:", Bronx NY"},{name:"Joyce Kilmer Park",location:{lat:40.828522,lng:-73.922673},visible:ko.observable(!0),active:ko.observable(!1),address:"Walton Ave, Bronx NY"},{name:"Mullaly Park",location:{lat:40.833092,lng:-73.924046},visible:ko.observable(!0),active:ko.observable(!1),address:"Jerome Ave, Bronx NY"}],initApp=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.828522,lng:-73.922673},zoom:16,mapTypeControl:!1}),ko.applyBindings(new ViewModel)},mapFail=function(){alert("Google Maps could not load at this time. Please try again later.")},ViewModel=function(){var self=this;self.locations=ko.observableArray(Model),self.listFilter=ko.observable(),self.listFilter.subscribe(function(newValue){var simpleValue=newValue.toLowerCase();self.locations().forEach(function(item){item.name.toLowerCase().indexOf(simpleValue)>=0?(item.visible(!0),item.marker.setVisible(!0)):(item.visible(!1),item.marker.setVisible(!1),item.marker==infoWindowService.marker&&0==item.marker.visible&&(infoWindowService.close(),infoWindowService.marker=null,self.removeActiveStatus(item)))})});var infoWindowService=new google.maps.InfoWindow;self.fillInfoWindow=function(item,infoWindow){if(infoWindow.marker!=item.marker){if(infoWindow.marker=item.marker,item.hasOwnProperty("id")){var firstLine=item.location.formattedAddress[0],secondLine=item.location.formattedAddress[1];if(infoWindow.setContent('<div><h3 class="infoWindow-title">'+item.name+"</h3><hr><br>"+firstLine+"<br>"+secondLine),item.contact.hasOwnProperty("formattedPhone")){var phone=item.contact.formattedPhone;infoWindow.setContent(infoWindow.content+"<br><br>"+phone+"</div>")}}else{var address=item.address,firstLine=address.substring(0,address.indexOf(",")),secondLine="Bronx, NY";infoWindow.setContent("<div>"+item.name+"<hr><br>"+firstLine+"<br>"+secondLine+"</div>")}infoWindow.open(map,item.marker),infoWindow.addListener("closeclick",function(){infoWindow.marker=null,self.removeActiveStatus(item)})}},self.createMarkers=function(array){array().forEach(function(item){if(!item.hasOwnProperty("marker")){var position=item.location,title=item.name,marker=new google.maps.Marker({position:position,title:title,map:map,animation:google.maps.Animation.DROP});marker.addListener("click",function(){self.animateMarker(this),self.fillInfoWindow(item,infoWindowService)}),item.marker=marker}})},self.initVisibility=function(item){item.visible=ko.observable(!0)},self.initStatus=function(item){item.active=ko.observable(!1)};var fsClientID="HKK50PCWV51XRJQUJAF4UEQGULLAFOWIOVWOBYLJZFTP4FTF",fsClientSecret="LUCLK3BPYXTO3Q25GBSH0FSH3RSIKL0HS1O2BMALNYII2VMD",fsVersion=20160909,fsSearchCenter="40.828522,-73.922673",fsRadius=500;self.findInfoLocation=function(){self.locations().forEach(function(item){var fsSearchCenter=item.location.lat+","+item.location.lng,fsURL="https://api.foursquare.com/v2/venues/search?client_id="+fsClientID+"&client_secret="+fsClientSecret+"&v="+fsVersion+"&ll="+fsSearchCenter+"&query="+item.name+"&address="+item.address+"&limit=1";$.getJSON(fsURL,function(results){for(var property in results.response.venues[0])item[property]=results.response.venues[0][property]}).always(function(){self.createMarkers(self.locations)})})},self.findInfoLocation();var fsSection="food",fsURL="https://api.foursquare.com/v2/venues/explore?client_id="+fsClientID+"&client_secret="+fsClientSecret+"&v="+fsVersion+"&ll="+fsSearchCenter+"&radius="+fsRadius+"&section="+fsSection+"&limit=50";$.ajax({url:fsURL,dataType:"json",success:function(results){results.response.groups[0].items.forEach(function(item){self.initVisibility(item.venue),self.initStatus(item.venue),self.locations.push(item.venue)}),self.createMarkers(self.locations)},error:function(result){var description;result.responseJSON.meta.errorType;description="Something wrong with request. Please contact site administrator.",alert("Could not retrieve Foursquare data.\n"+description)}}),self.getMarker=function(object){var marker=object.marker;self.animateMarker(marker)},self.getInfoWindow=function(object){self.fillInfoWindow(object,infoWindowService)},self.activate=function(object){object.active(!0),self.locations().forEach(function(item){item!=object&&self.removeActiveStatus(item)})},self.removeActiveStatus=function(object){object.active(!1)},self.animateMarker=function(marker){marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){marker.setAnimation(null)},2150)};var listContainer=$(".list-container"),menuIcon=$(".menu-icon");self.toggleMenu=function(){listContainer.toggleClass("open-menu"),menuIcon.toggleClass("slide-icon")}};